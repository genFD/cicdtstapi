name: Continous deployment
# will run job only when main & production push and when PR
# define an image we need for terraform job

on:
  push:
    branches:
      - main
      - production
  pull_request:
jobs:
  Test:
    name: Test
    runs-on: ubuntu-22.04
    steps:
      - name: Check out the repository
        uses: actions/checkout@v3
      - name: Run Tests
        # setup project to run tests with docker compose
        # run: docker-compose run --rm app sh -c "test"
        run: echo "RUNNING TEST"

  Lint:
    name: Lint
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Lint Code Base
        uses: github/super-linter@v4
        env:
          VALIDATE_ALL_CODEBASE: false
          DEFAULT_BRANCH: main
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

        # run: echo "RUNNING LINT /"

  # Validate-terraform:
  #   name: Terraform validation
  #   runs-on: ubuntu-22.04
  #   defaults:
  #     run:
  #       shell: bash
  #       working-directory: ./deploy
  #   steps:
  #     - name: Check out the repo
  #       uses: actions/checkout@v3

  #     - name: Setup Terraform
  #       uses: addnab/docker-run-action@v3
  #       with:
  #         image: hashicorp/terraform:latest
  #     - name: Terraform init and format
  #       run: |
  #         terraform init -backend=false
  #         terraform validate
  #         terraform fmt -check

  Build-push:
    name: Build and push image
    runs-on: ubuntu-22.04
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/production'
    steps:
      - name: Check out the repository
        uses: actions/checkout@v3
      - name: Build and push
        run: echo "Build and push code here /"
